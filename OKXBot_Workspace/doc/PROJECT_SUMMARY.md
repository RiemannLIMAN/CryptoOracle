# 🤖 CryptoOracle: AI 驱动的量化交易终端

> **"像华尔街专业人士一样思考，像算法机器人一样执行。"**

CryptoOracle 是一个集成 DeepSeek-V3 大模型与 CCXT 交易框架的下一代量化交易系统。它通过 8 大核心技术，构建了一个具备“感知-思考-决策-风控”闭环的智能体。

---

## 🌟 十一大核心特性 (Key Features)

### 1. 🧠 混合智能决策引擎 (Hybrid AI Engine) [核心]

不同于简单的 API 调用，我们构建了“LLM + 硬指标”的双脑模型，赋予机器人真正的理解力：

*   **右脑 (感知)**：集成 **DeepSeek-V3** 大模型，不仅能读懂 K 线形态（如头肩顶、收敛三角），更能结合宏观逻辑进行趋势推演。**v2.1 新增趋势感知**：能识别单边行情的 RSI 钝化现象，拒绝在牛市中摸顶做空。
*   **左脑 (计算)**：内置金融级 TA 库，实时计算 RSI, MACD, Bollinger Bands，为 AI 提供精确的数学坐标。
*   **盈亏感知 (PnL Awareness)**：AI 实时监控每一笔持仓的浮动盈亏，一旦发现利润回撤迹象（如 >1.5% 浮盈且动能减弱），立即触发**“止盈保护”**，拒绝过山车。

### 2. 🎭 动态人格 AI 大脑 (Adaptive AI Persona)

系统拒绝“一招鲜”，而是根据 **ADX 趋势强度** 与 **ATR 波动率** 实时切换交易人格：

*   🦁 **激进趋势猎手 (High Trend)**：当市场单边剧烈波动时，AI 变身为激进派，放大止盈空间，紧咬主升浪。**具备反手意识**：若做错方向，能果断认错并反手开单。
*   🦉 **冷静避险专家 (High Choppy)**：当市场剧烈震荡时，AI 自动降维，空仓观望或仅做极短线反转。
*   🐼 **耐心网格套利 (Low Volatility)**：当市场横盘如水时，AI 切换为网格交易员，专注于微小波动的积少成多。

### 3. 🛡️ 三重安全风控体系 (Triple-Check Risk Control)

每一笔交易都必须通过三道严苛的资金防火墙，缺一不可：

1.  **配置锁 (Config Limit)**：配置文件设定的 `amount` 是不可逾越的红线。
2.  **AI 软限 (AI Suggestion)**：AI 可根据信心指数 (Confidence Score) 主动建议减仓。
3.  **余额硬限 (Balance Guard)**：实时计算购买力（含手续费），强制修正下单量，彻底杜绝“透支报错”。
4.  **买卖逻辑隔离 (Logic Separation)**：买入严格受预算限制，但卖出（止盈/止损）拥有最高优先级，不受预算限制，确保满仓状态下也能随时逃生。

### 4. 🔔 实时全渠道推送 (Omni-Channel Notification)

拒绝黑盒运行，让您随时掌握资金动态。支持 钉钉 / 飞书 / Slack / Discord Webhook：

*   🚀 **交易提醒**：买入/卖出/平仓时，即时推送价格、数量与 AI 决策理由。
*   🚑 **风控报警**：触发止盈/止损或下单失败时，第一时间发送高亮警报。

### 5. 💠 终端可视化看板 (CLI Dashboard) & 战绩回溯

*   **全天候战绩播报**：
    *   **启动即现**：每次启动时，自动加载历史战绩，绘制最近 10 次盈亏趋势图。
    *   **整点播报**：每隔 **1 小时** 自动打印 ASCII 收益曲线，挂机也能随时查看资金走势。
    *   **实时监控**：每分钟刷新账户权益与浮动盈亏。
*   **双重记录机制**：
    *   **数据留存**：盈亏数据永久保存至 `pnl_history.csv`，重启不丢失。
    *   **可视化图表**：每次交易后自动生成 `.png` 收益折线图至 `png/` 目录，文件名带时间戳，方便复盘。
*   **动态行情流**：实时刷新价格涨跌箭头 (🟢/🔴) 与账户 USDT 余额。
*   **纯净日志**：自动屏蔽底层库噪音，只保留关键决策路径。

### 6. 🏦 智能资金治理 (Smart Capital Governance)

*   **独立资金舱壁**：支持为 ETH 分配 30%，SOL 分配 70%。不同币种资金互不干扰，防止单一币种爆仓拖累全尾。
*   **智能 PnL 校准**：启动时自动识别钱包闲置资金，只对“本次运行投入的本金”负责，解决传统机器人盈亏计算混乱的痛点。
    *   *注：若实际资金 (如 70U) 与配置资金 (如 60U) 偏差 > 10%，系统会自动将盈亏基准校准为 70U (防止虚假盈利)，但交易配额仍严格锁定为 60U (保证资金隔离)。*
*   **百分比风控**：支持“赚 20% 止盈”或“亏 10% 止损”的相对值设置，小白也能轻松掌握。

### 7. � 现货/合约双模引擎 (Hybrid Trading Engine)

*   **多线程并发**：支持同时运行 BTC 合约 (10x 杠杆、做空) 和 ETH 现货 (只买不卖、囤币) 策略。
*   **独立状态机**：每个币种拥有独立的决策内存与信号历史，互不干扰。

### 8. 🛡️ 工业级自愈架构 (Self-Healing Arch)

为 7x24 小时无人值守设计：

*   **启动自检**：开机自动检测 API 权限、AI 连通性和账户余额，有故障立即报错。
*   **数据热启动**：启动即从交易所拉取历史数据，无需等待，第 1 秒即可精准交易。
*   **毫秒级熔断**：下单前 1ms 再次核对价格，若偏差 > 1% (防插针)，立即拦截交易。

### 9. 💰 智能费率与小额交易引擎 (Smart Fee & Micro-Trade) [新增]

*   **VIP 费率自动同步**：启动时自动识别您的 VIP 等级，精准获取 Taker/Maker 费率（如 Lv5 费率 0.02%），告别手动配置。
*   **小资金自动适配**：
    *   **数量自适应**：当 AI 建议买入量小于交易所最小限制（如 DOGE < 100个）时，若余额允许，系统会自动提升至最小允许单位，避免被拒单。
    *   **金额自适应**：当交易额小于最小限制（如 < 2 USDT）时，自动计算补足金额所需的数量。
*   **净利润风控**：根据您的真实费率，自动计算“保本及格线”。若浮盈不足以覆盖双向手续费，系统会强制拦截平仓信号，拒绝给交易所打工。

### 10. 🏗️ 智能加仓引擎 (Smart Position Building) [新增]

系统不仅仅支持“一键梭哈”，更支持专业的**金字塔式加仓 (Pyramiding)**：

*   **分批建仓**：允许在底仓盈利且趋势确认延续时，自动追加投入。
*   **风险均摊**：相比一次性买入，分批建仓能有效降低平均成本风险。
*   **智能边界**：加仓严格受总配额 (`allocation`) 限制，绝不无限加码。

### 11. ⚠️ v2.1 趋势感知升级 (Trend-Aware) [新增]

针对单边行情（暴涨暴跌）的重大升级：
*   **反手逻辑 (Reversal)**：当持仓方向与市场趋势背离时，AI 会承认错误，主动平仓并**反手开单**，将亏损转化为盈利机会。
*   **RSI 钝化警示**：教导 AI 在强趋势中忽略超买/超卖指标，防止摸顶做空。
*   **止损优先**：浮亏 > 3% 且趋势未变，不等待形态确认，直接止损离场。

---

## 📖 核心策略文档 (Core Strategy Guide)

为了帮助高阶用户深入理解机器人的**资金分配逻辑**与**交易决策标准**，我们编写了详细的策略手册。

👉 **[点击查看：核心交易逻辑与资金管理手册 (Strategy & Capital Guide)](STRATEGY_DETAILS.md)**

该文档详细涵盖了：
1.  **资金舱壁机制**：如何计算剩余额度与资金隔离。
2.  **交易时资金策略**：
    *   **买入配额**：配置限制 vs 余额限制 vs 杠杆倍数。
    *   **平仓逻辑**：为什么卖出不受配额限制？
    *   **最小交易处理**：如何优雅处理交易所的 Dust Limit。
3.  **AI 动态买卖标准**：DeepSeek 在不同市场形态下的具体决策逻辑表。
4.  **交易执行的三重门**：价格时效性、最小交易额与风控取小逻辑。

---

## 🚀 快速开始 (Quick Start)

### 1. 环境准备

推荐部署环境：Ubuntu 轻量云服务器（阿里云香港/新加坡均可）。

建议使用 Python 虚拟环境以避免依赖冲突（任选其一）：

```bash
# 方式 A：Python venv
python -m venv venv

# 激活环境 (windows)
.\venv\Scripts\activate

# 进入源代码目录
cd OKXBot_Workspace/src

# 安装依赖
pip install -r requirements.txt
```

Ubuntu 服务器（Anaconda / Conda）快速安装（推荐）：

```bash
# 1. 下载并安装 Anaconda
wget https://repo.anaconda.com/archive/Anaconda3-2024.10-1-Linux-x86_64.sh
bash Anaconda3-2024.10-1-Linux-x86_64.sh

# 2. 初始化环境变量
source /root/anaconda3/etc/profile.d/conda.sh
echo ". /root/anaconda3/etc/profile.d/conda.sh" >> ~/.bashrc

# 3. 创建并激活虚拟环境
conda create -n ds python=3.10
conda activate ds

# 4. 进入项目目录并安装依赖
# (假设您已克隆项目至 ~/CryptoOracle)
cd ~/CryptoOracle/OKXBot_Workspace/src
pip install -r requirements.txt
```

### 2. 申请 API 密钥

1.  登录 OKX 官网，进入 API 管理 页面。
2.  创建 V5 API Key，权限勾选：**读取** 和 **交易**。
3.  **重要**：如果是合约交易，请将账户模式设置为“单币种保证金”或“跨币种保证金”模式。

### 3. 项目配置

复制配置文件模板（请确保在 `src` 目录下执行）：

```bash
cp config.example.json config.json
```

编辑 `config.json` (详细参数说明请阅 `CONFIG_README.md`)：

*   填入 `api_key`, `secret`, `password`。
*   设置 `deepseek_api_key`。
*   调整 `symbols` 中的资金分配 `allocation` (建议先用小额测试)。

---

## ⚠️ 风险与免责声明 (Risk Disclaimer)

**量化交易具有极高的风险，使用本软件代表您同意以下条款：**

1.  **市场风险**：加密货币市场波动剧烈，极端行情下可能出现滑点巨大、流动性枯竭等情况，导致止损失效。
2.  **技术风险**：软件可能存在未发现的 Bug；交易所 API 可能中断或延迟；服务器可能出现网络故障。
3.  **模型风险**：DeepSeek 等 LLM 模型存在“幻觉”问题，其分析结果仅供参考，不构成绝对的投资建议。
4.  **资金风险**：请务必使用**资金隔离**功能，切勿将生活所需资金用于高风险投机。
5.  **免责条款**：本软件为开源项目，开发者不对任何因使用本软件产生的直接或间接亏损承担责任。

> **忠告：永远敬畏市场，永远不要 All-in。**

---

## � 项目结构 (File Structure)

为了保持整洁，项目采用了模块化的目录结构：

```
OKXBot_Workspace/
├── src/                # 源代码目录
│   ├── okx_deepseek.py     # 主程序入口 (交易逻辑核心)
│   ├── plot_pnl.py         # 图表生成模块
│   ├── config.json         # 配置文件 (需手动创建)
│   └── requirements.txt    # 依赖包列表
├── doc/                # 文档目录
│   ├── PROJECT_SUMMARY.md  # 项目综合介绍
│   ├── STRATEGY_DETAILS.md # 核心交易策略手册
│   └── CONFIG_README.md    # 配置文件说明
├── log/                # 日志目录 (自动生成)
│   ├── trading_bot_*.log   # 带时间戳的运行日志
│   └── LOG_ANALYSIS_REPORT.md # 日志分析报告
├── png/                # 图表目录 (自动生成)
│   └── pnl_chart_*.png     # 带时间戳的收益曲线图
└── README.md           # 快速入门指南
```

---

## �📄 许可证 (License)

本项目采用 **CC-BY-NC-SA-4.0** (署名-非商业性使用-相同方式共享 4.0 国际) 协议。

这意味着您可以：
*   ✅ **分享**：在任何媒介以任何形式复制、发行本作品。
*   ✅ **修改**：修改、转换或以本作品为基础进行创作。

但必须遵守以下条件：
*   🚫 **非商业性使用**：您不得将本作品用于商业目的（如打包出售、付费入群等）。
*   🔄 **相同方式共享**：如果您修改了本作品，您必须使用相同的许可证发布您的贡献。
*   ✍️ **署名**：您必须保留原作者署名。

---

## 🤝 支持与贡献 (Support & Contribution)

CryptoOracle 是一个开源项目，我们需要您的力量让它变得更强！

### 如何贡献

*   **提交 Bug**：如果您发现程序报错或逻辑漏洞，请提交 Issue 并附上 `trading_bot.log` 中的错误堆栈。
*   **功能建议**：欢迎提出新的指标算法、风控策略或交易适配请求。
*   **代码提交**：Fork 本项目，创建您的 Feature 分支，并提交 Pull Request。

### 联系我们

*   **GitHub Issues**: [项目地址/Issues]
*   **Email**: [1211018392@qq.com]

如果您觉得本项目对您有帮助，欢迎使用作者的 OKX 邀请码注册，这将支持 **Riemann** 持续维护本项目。

*   🦄 **OKX 全球邀请码**: `95572792`
*   👉 **注册链接**: [点击这里注册 OKX (免翻墙)](https://www.okx.com/join/95572792)

**感谢每一位贡献者！让 AI 赋能每一个交易员。**

---
**作者：Riemann**
